# glm
#add_subdirectory("${CMAKE_CURRENT_SOURCE_DIR}/glm/")
file(GLOB_RECURSE GLM_FILES_HPP "${CMAKE_CURRENT_SOURCE_DIR}/glm/glm/*.hpp") 
file(GLOB_RECURSE GLM_FILES_CPP "${CMAKE_CURRENT_SOURCE_DIR}/glm/glm/*.cpp")
add_library(
    glm 
    STATIC 
    ${GLM_FILES_HPP}
    ${GLM_FILES_CPP}
)
set_target_properties(glm PROPERTIES LINKER_LANGUAGE CXX)
target_include_directories(glm PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/glm/")
target_link_libraries(glm PUBLIC ${CORE_LIBS})


# glfw
add_subdirectory("${CMAKE_CURRENT_SOURCE_DIR}/glfw/")

# libepoxy
file(WRITE "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/config/config.h"
"//TEMP FILE GENERATED BY CMAKE"
)
add_library(
    LIBEPOXY_CONFIG_LIB 
    STATIC
    "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/config/config.h"
)
target_include_directories(LIBEPOXY_CONFIG_LIB PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/config/")
set_target_properties(LIBEPOXY_CONFIG_LIB PROPERTIES LINKER_LANGUAGE CXX)


file(GLOB LIBEPOXY_REGISTRY_FILES "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/registry/*.xml")
foreach (LIBEPOXY_REGISTRY ${LIBEPOXY_REGISTRY_FILES})
    get_filename_component(LIBEPOXY_REGISTRY_NAME ${LIBEPOXY_REGISTRY} NAME_WLE)
    file(WRITE "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/include/epoxy/${LIBEPOXY_REGISTRY_NAME}_generated.h"
    "//TEMP FILE GENERATED BY CMAKE"
    )
    file(WRITE "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/src/${LIBEPOXY_REGISTRY_NAME}_generated_dispatch.c"
    "//TEMP FILE GENERATED BY CMAKE"
    )
endforeach()

file(GLOB_RECURSE LIBEPOXY_FILES_H "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/src/*.h") 
file(GLOB_RECURSE LIBEPOXY_FILES_C "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/src/*.c")
file(GLOB_RECURSE LIBEPOXY_INCLUDE_FILES "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/include/*.h")
add_library(
    libepoxy 
    STATIC 
    ${LIBEPOXY_FILES_H}
    ${LIBEPOXY_FILES_CPP}
    ${LIBEPOXY_INCLUDE_FILES}
)

foreach (LIBEPOXY_REGISTRY ${LIBEPOXY_REGISTRY_FILES})
  get_filename_component(LIBEPOXY_REGISTRY_NAME ${LIBEPOXY_REGISTRY} NAME_WLE)
  execute_process(
      COMMAND python3 "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/src/gen_dispatch.py"  "--includedir" "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/include/epoxy/" "--srcdir" "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/src/" "--source" "--header" "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/registry/${LIBEPOXY_REGISTRY_NAME}.xml"
      WORKING_DIRECTORY ${CMAKE_CURRENT_LIST_DIR}
  )
endforeach()

set_target_properties(libepoxy PROPERTIES LINKER_LANGUAGE C)
target_include_directories(libepoxy PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/libepoxy/include/")
target_link_libraries(libepoxy PUBLIC ${CORE_LIBS} LIBEPOXY_CONFIG_LIB glm glfw)
